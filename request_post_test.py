import requests, json

last_page = 510
sortedBy = "hottest"

payload = '{"page":%d,"group":"public","size":"all","fileType":"all","license":"all","viewed":"all","categoryIds":[],"search":"","sortBy":"%s","userId":null,"competitionId":null,"organizationId":null,"maintainerOrganizationId":null,"minSize":null,"maxSize":null,"isUserQuery":false,"hasTasks":false,"topicalDataset":null,"includeTopicalDatasets":false}'  ## "{\"page\":%d,\"group\":\"public\",\"size\":\"all\",\"fileType\":\"all\",\"license\":\"all\",\"viewed\":\"all\",\"categoryIds\":[],\"search\":\"\",\"sortBy\":\"%s\",\"userId\":null,\"organizationId\":null,\"maintainerOrganizationId\":null,\"minSize\":null,\"maxSize\":null,\"isUserQuery\":false,\"hasTasks\":false}"
headers = {
    'content-type': "application/json",
    # 'cookie': "ka_sessionid=632ebd0d54328c44504e957c81983ff3; _ga=GA1.2.393254855.1587692457; .ASPXAUTH=165B78564F91CD0621FC6162AFF45EFBEE5771C706EB72E2D8ADDAF50CEB592864CF2A093699AF39C3324CA2D11C1832857FB7B822F69FBF2F1747E6A06017E94B2A7FA2B9F1583E06E5AA1331524D5BFC5C0BE6; _gid=GA1.2.646163506.1588456035; __stripe_mid=3a4ec8dd-57b3-4430-be32-a7c719c9aead; CSRF-TOKEN=CfDJ8LdUzqlsSWBPr4Ce3rb9VL8d5u6i3BCdcRGwQ8KpfpN_Q8elcZgjvoF-moxqsBcjV3os5f5IevHWa5wr5fbCXB901RYzK0tP75DqggVtTmnlavIoIau4RgmQis9r_OGl6WVAaBpm7KogpASJlGTOBd8; GCLB=CKrI04eNsrS9Wg; intercom-session-koj6gxx6=V2dmRnZpTGcyUVNHTHFQdmRUc3ZGbTJMYjlVajRoUnNhYWp3TFBTRDZQMEo0T3h0eEZ4ZS93bkRybmJEN2ZkWi0taFJ6cC9Kd3c3OGU2clJyVkZqQWJSZz09--63d5f864ee9e588e6b1144d9394909060b4d440d; XSRF-TOKEN=CfDJ8LdUzqlsSWBPr4Ce3rb9VL98jdE3WHCDZwebp_8glwZTGKeyvdAargjg5diJDW_s6TrIv-_mgkv-diPryV0ip9Rk1QmCrrfW-6_gbWVQ_An8PZd6sUz4Xkddd6Y_54Acgydrl1n9oFiRM3DvzGwLEWyozqBmVFaAkf_pijyL2Dv7lxKRNP_gj-cIppzFlrJZ1g; CLIENT-TOKEN=eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJpc3MiOiJrYWdnbGUiLCJhdWQiOiJjbGllbnQiLCJzdWIiOiJ4bWsyMzMiLCJuYnQiOiIyMDIwLTA1LTAzVDIxOjE5OjQ3LjA5MjQ4ODNaIiwiaWF0IjoiMjAyMC0wNS0wM1QyMToxOTo0Ny4wOTI0ODgzWiIsImp0aSI6ImQ2ZDk2MmExLTUyODAtNGRjOC1iZmY2LTY1MmY0MzJiN2U3MyIsImV4cCI6IjIwMjAtMDYtMDNUMjE6MTk6NDcuMDkyNDg4M1oiLCJ1aWQiOjI2NzM2MzEsImZmIjpbIkZsZXhpYmxlR3B1IiwiS2VybmVsc0ludGVybmV0IiwiRGF0YUV4cGxvcmVyVjIiLCJEYXRhU291cmNlU2VsZWN0b3JWMiIsIktlcm5lbHNWaWV3ZXJJbm5lclRhYmxlT2ZDb250ZW50cyIsIkZvcnVtV2F0Y2hEZXByZWNhdGVkIiwiTmV3S2VybmVsV2VsY29tZSIsIk1kZUltYWdlVXBsb2FkZXIiLCJLZXJuZWxzUXVpY2tWZXJzaW9ucyIsIkRpc2FibGVDdXN0b21QYWNrYWdlcyIsIlBpbk9yaWdpbmFsRG9ja2VyVmVyc2lvbiIsIlBob25lVmVyaWZ5Rm9yR3B1IiwiQ2xvdWRTZXJ2aWNlc0tlcm5lbEludGVnIiwiVXNlclNlY3JldHNLZXJuZWxJbnRlZyIsIk5hdmlnYXRpb25SZWRlc2lnbiIsIktlcm5lbHNTbmlwcGV0cyIsIktlcm5lbFdlbGNvbWVMb2FkRnJvbVVybCIsIlRwdUtlcm5lbEludGVnIiwiS2VybmVsc0ZpcmViYXNlTG9uZ1BvbGxpbmciLCJEYXRhc2V0TGl2ZU1vdW50Il19.",
    # 'x-xsrf-token': "CfDJ8LdUzqlsSWBPr4Ce3rb9VL98jdE3WHCDZwebp_8glwZTGKeyvdAargjg5diJDW_s6TrIv-_mgkv-diPryV0ip9Rk1QmCrrfW-6_gbWVQ_An8PZd6sUz4Xkddd6Y_54Acgydrl1n9oFiRM3DvzGwLEWyozqBmVFaAkf_pijyL2Dv7lxKRNP_gj-cIppzFlrJZ1g",
    'cookie': 'ka_sessionid=300ac300f45959eea5cdbfcf6a79f43e; _ga=GA1.2.1234651322.1614056813; GCLB=CK_Q2sC22PKl_AE; CSRF-TOKEN=CfDJ8LdUzqlsSWBPr4Ce3rb9VL-U-YFvdLs-D0c1OYFUKiQhrabUIDLZQBNTNulPVEvXzGWx586Qr0nENJabvDXywRCF97DRMxIsXOIU9r-2Qqa6DtkHv9seavn8mZ5Atf505y2-B_ffiX7ASuUuc2vaFVc; _gid=GA1.2.1707050155.1616305142; XSRF-TOKEN=CfDJ8LdUzqlsSWBPr4Ce3rb9VL-PFO8doRN5qa7lYJjgYUdZE34nyqNT_TnnQBLzERTyzrgXY0_e7n7ArHUgDZ9e0WCdWfWamzcvCqxSovF3vsCLcsFl5hMzXqOdBeLnmvX2wcuTMCF72FP7I9dDY6eWZM8; CLIENT-TOKEN=eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJpc3MiOiJrYWdnbGUiLCJhdWQiOiJjbGllbnQiLCJzdWIiOm51bGwsIm5idCI6IjIwMjEtMDMtMjFUMDU6NDE6MDkuNTEwMTgyOVoiLCJpYXQiOiIyMDIxLTAzLTIxVDA1OjQxOjA5LjUxMDE4MjlaIiwianRpIjoiZGY1NTBhMTgtYjIyNi00OTI2LWJjZWQtNWJjODY2OTIzODhlIiwiZXhwIjoiMjAyMS0wNC0yMVQwNTo0MTowOS41MTAxODI5WiIsImFub24iOnRydWUsImZmIjpbIkRvY2tlck1vZGFsU2VsZWN0b3IiLCJBY3RpdmVFdmVudHMiLCJHY2xvdWRLZXJuZWxJbnRlZyIsIktlcm5lbEVkaXRvckNvcmdpTW9kZSIsIkNhaXBFeHBvcnQiLCJDYWlwTnVkZ2UiLCJLZXJuZWxzQWRqdXN0QmFzZVBhdGgiLCJLZXJuZWxzRmlyZWJhc2VMb25nUG9sbGluZyIsIktlcm5lbHNQcmV2ZW50U3RvcHBlZFRvU3RhcnRpbmdUcmFuc2l0aW9uIiwiRGF0YXNldExpdmVNb3VudCIsIkRhdGFzZXRzVGFza09uTm90ZWJvb2tMaXN0aW5nIiwiRGF0YXNldHNEYXRhRXhwbG9yZXJWM1RyZWVMZWZ0IiwiQXZhdGFyUHJvZmlsZVByZXZpZXciLCJEYXRhc2V0c0RhdGFFeHBsb3JlclYzQ2hlY2tGb3JVcGRhdGVzIiwiRGF0YXNldHNEYXRhRXhwbG9yZXJWM0NoZWNrRm9yVXBkYXRlc0luQmFja2dyb3VuZCIsIktlcm5lbHNTdGFja092ZXJmbG93U2VhcmNoIiwiS2VybmVsc01hdGVyaWFsTGlzdGluZyIsIkRhdGFzZXRzTWF0ZXJpYWxEZXRhaWwiLCJEYXRhc2V0c01hdGVyaWFsTGlzdENvbXBvbmVudCIsIkNvbXBldGl0aW9uRGF0YXNldHMiLCJEaXNjdXNzaW9uc1Vwdm90ZVNwYW1XYXJuaW5nIiwiVGFnc0V4cGVyaW1lbnRVSSIsIlRhZ3NMZWFybkFuZERpc2N1c3Npb25zVUkiLCJOb1JlbG9hZEV4cGVyaW1lbnQiLCJOb3RlYm9va3NMYW5kaW5nUGFnZSIsIkRhdGFzZXRzRnJvbUdjcyIsIlRQVUNvbW1pdFNjaGVkdWxpbmciLCJEaXNjdXNzaW9uS01Gb3J1bVBhZ2UiLCJEaXNjdXNzaW9uS01Db21wZXRpdGlvbnMiLCJEaXNjdXNzaW9uS01EYXRhc2V0cyIsIkRpc2N1c3Npb25LTVRhZ3MiLCJEaXNjdXNzaW9uS01BYlRlc3QiLCJLZXJuZWxzTGVzc1JhcGlkQXV0b1NhdmUiXSwicGlkIjoia2FnZ2xlLTE2MTYwNyIsInN2YyI6IndlYi1mZSIsInNkYWsiOiJBSXphU3lEQU5HWEZIdFNJVmM1MU1JZEd3ZzRtUUZnbTNvTnJLb28iLCJibGQiOiJiMDhjN2VhZjI5YTI5YzAxNjIyNjgyMzkzYjQ0YzU1MjlkODgzYTA2In0.',
    'x-xsrf-token': 'CfDJ8LdUzqlsSWBPr4Ce3rb9VL-PFO8doRN5qa7lYJjgYUdZE34nyqNT_TnnQBLzERTyzrgXY0_e7n7ArHUgDZ9e0WCdWfWamzcvCqxSovF3vsCLcsFl5hMzXqOdBeLnmvX2wcuTMCF72FP7I9dDY6eWZM8',
}  ## has to be updated regularly.

totalNum = 0
while True:
    response1 = requests.request("POST", "https://www.kaggle.com/requests/SearchDatasetsRequest",
                                         data=payload % (last_page, sortedBy), headers=headers)
    infos = json.loads(response1.text)
    coreLen = len(infos["result"]["datasetList"]["items"])
    totalNum += coreLen
    if coreLen == 0:
        break
    print(last_page * 20)
    last_page += 1